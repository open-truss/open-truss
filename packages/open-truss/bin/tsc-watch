#!/bin/bash

# Directory of open-truss project
# Escape @ so it is a valid path
package_dir=$PACKAGE_DIR
cd $package_dir

# Function to terminate both tsc processes
terminate_tsc_processes() {
  echo "Terminating TypeScript watch processes..."
  pkill -P $$
}

# Trap SIGINT and SIGTERM and call the function to terminate tsc processes
trap 'terminate_tsc_processes' SIGINT SIGTERM

# Run tsc with --watch for tsconfig.json and capture the output
echo "Running tsc watch using $($package_dir/tsconfig.json)"
(npm run tsc:watch) &

# Run tsc with --watch for tsconfig.esm.json and capture the output
echo "Running tsc watch using $($package_dir/tsconfig.esm.json)"
(npm run tsc:watch:esm) &

# Wait for both background processes to complete or for a signal to terminate
wait
